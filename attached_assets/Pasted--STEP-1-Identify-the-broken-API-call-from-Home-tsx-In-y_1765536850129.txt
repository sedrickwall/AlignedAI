âœ… STEP 1 â€” Identify the broken API call from Home.tsx

In your Home screen, you likely have something like:

const { data, isError } = useQuery({
  queryKey: ["/api/home"],
  queryFn: () => apiRequest("GET", "/api/home"),
});


or:

apiRequest("GET", "/api/profile/...") 


The screenshot says after onboarding completes, the redirect goes to /.

And then the Home screen loads â†’ and fires an API request â†’ 500 â†’ UI displays:

Failed to load data.

This means the issue is NOT onboarding anymore â€” it's the backend route that Home.tsx is expecting.

âœ… STEP 2 â€” Confirm what Home is requesting

I need to see your Home.tsx (show me the file).
BUT I already know the problem pattern:

Case 1 â€” Your Home requests /api/home but that route does not exist

â†’ 404 or 500
â†’ Home shows â€œFailed to load data.â€

Case 2 â€” The route exists, but Firebase Admin throws:
Error: Missing or insufficient permissions
Error: Invalid ID token
Error: user.uid undefined


This happens when:

âŒ The API route is missing authorization decoding
âŒ You didn't include the Bearer token in the request
âŒ Vercel function cannot read req.headers.authorization
âœ… STEP 3 â€” Quick test to confirm

Open your browser devtools â†’ Network â†’ Refresh home page.

Look at the failing API call.

Tell me the URL of the failing request.

It will be something like:

https://aligned-xxxx.vercel.app/api/...   â†’ 500


Copy/paste the URL and response body.

ğŸ”¥ STEP 4 â€” The fix (depending on which one is wrong)
Fix 1 â€” Missing Bearer Token (most common)

Check your apiRequest helper:

const token = await auth.currentUser?.getIdToken();


Ensure your request includes:

Authorization: `Bearer ${token}`,


If this is missing â†’ every API route requiring auth returns 500.

Fix 2 â€” Backend does not decode user â†’ causes crash

Every authenticated API route MUST use this pattern:

const authHeader = req.headers.authorization;
if (!authHeader?.startsWith("Bearer ")) {
  return res.status(401).json({ error: "Unauthorized" });
}

const token = authHeader.split("Bearer ")[1];
const decoded = await getAuth().verifyIdToken(token);
const uid = decoded.uid;


If any route (e.g., /api/home or /api/profile/*) is missing this â†’ 500 error.

Fix 3 â€” The Home route doesnâ€™t exist

If Home.tsx calls:

/api/home


You MUST create:

/api/home.ts


Otherwise â†’ 500.